#+TITLE: Problem 3 stock_main
#+TESTY: PREFIX="prob3"
#+TESTY: USE_VALGRIND=1

* stock_main data/stock-ascending.txt all
Runs the ~stock_main~ program on a the file data/stock-ascending.txt to
see if the correct command line output is produced.

#+TESTY: program='./stock_main data/stock-ascending.txt 15'
#+BEGIN_SRC sh
==STOCK DATA==
data_file: data/stock-ascending.txt
count: 10
prices: [10.00, 20.00, 30.00, ...]
lo_index:  0
hi_index:  9
best_buy:  0
best_sell: 9
profit:    90.00
==PLOT DATA==
start/stop:  0 10
max_height:  15
price range: 90.00
plot step:   6.00
           +B========S+
     94.00 |         H|
     88.00 |        *H|
     82.00 |        *H|
     76.00 |       **H|
     70.00 |      ***H|
     64.00 |      ***H|
     58.00 |     ****H|
     52.00 |     ****H|
     46.00 |    *****H|
     40.00 |   ******H|
     34.00 |   ******H|
     28.00 |  *******H|
     22.00 |  *******H|
     16.00 | ********H|
     10.00 |L********H|
           +^----^----+
            0    5    
#+END_SRC

* stock_main fail to open
Runs on a stock file that does not exist.  This will lead to and error
and exit. Note there are 3 separate error messages complaining
1. From count_lines() in stock_funcs.c
2. From stock_load() in stock_funcs.c
3. From main() in stock_main.c

#+TESTY: exitcode_expect=1
#+TESTY: program='./stock_main data/does-not-exist.txt 20'
#+BEGIN_SRC sh
Could not open file 'data/does-not-exist.txt', cannot count lines
Unable to open stock file 'data/does-not-exist.txt', cannot load stock data
Failed to load stock file, exiting
#+END_SRC

* stock_main data/stock-ascending.txt 5 to 10
Runs the ~stock_main~ program on a the file
data/stock-ascending.txt to see if the correct command line output is
produced; limits output to indices 5 and up.

#+TESTY: program='./stock_main data/stock-ascending.txt 15 5 10'
#+BEGIN_SRC sh
==STOCK DATA==
data_file: data/stock-ascending.txt
count: 10
prices: [10.00, 20.00, 30.00, ...]
lo_index:  0
hi_index:  9
best_buy:  0
best_sell: 9
profit:    90.00
==PLOT DATA==
start/stop:  5 10
max_height:  15
price range: 90.00
plot step:   6.00
           +====S+
     94.00 |    H|
     88.00 |   *H|
     82.00 |   *H|
     76.00 |  **H|
     70.00 | ***H|
     64.00 | ***H|
     58.00 |****H|
     52.00 |****H|
     46.00 |****H|
     40.00 |****H|
     34.00 |****H|
     28.00 |****H|
     22.00 |****H|
     16.00 |****H|
     10.00 |****H|
           +^----+
            5    
#+END_SRC

* stock_main data/stock-ascending.txt 5 to End
Runs the ~stock_main~ program on data/stock-ascending.txt but specify
only the 3 command line args which are
1. stock file
2. max height
3. initial index
This leaves off the stop index which should default to the end of the
prices array. In this case the output should be the same as the
preceding test

#+TESTY: program='./stock_main data/stock-ascending.txt 15 5'
#+BEGIN_SRC sh
==STOCK DATA==
data_file: data/stock-ascending.txt
count: 10
prices: [10.00, 20.00, 30.00, ...]
lo_index:  0
hi_index:  9
best_buy:  0
best_sell: 9
profit:    90.00
==PLOT DATA==
start/stop:  5 10
max_height:  15
price range: 90.00
plot step:   6.00
           +====S+
     94.00 |    H|
     88.00 |   *H|
     82.00 |   *H|
     76.00 |  **H|
     70.00 | ***H|
     64.00 | ***H|
     58.00 |****H|
     52.00 |****H|
     46.00 |****H|
     40.00 |****H|
     34.00 |****H|
     28.00 |****H|
     22.00 |****H|
     16.00 |****H|
     10.00 |****H|
           +^----+
            5    
#+END_SRC

* stock_main data/stock-min-after-max.txt
Runs the ~stock_main~ program on a the file
data/stock-min-after-max.txt to see if the correct command line output
is produced.

#+TESTY: program='./stock_main data/stock-min-after-max.txt 14'
#+BEGIN_SRC sh
==STOCK DATA==
data_file: data/stock-min-after-max.txt
count: 15
prices: [223.00, 292.00, 27.00, ...]
lo_index:  10
hi_index:  4
best_buy:  2
best_sell: 4
profit:    296.00
==PLOT DATA==
start/stop:  0 15
max_height:  14
price range: 309.00
plot step:   22.07
           +--B=S----------+
    300.93 |    H   *      |
    278.86 | *  H   *      |
    256.79 | *  H   *      |
    234.71 | *  H   *      |
    212.64 |**  H   *      |
    190.57 |**  H * *      |
    168.50 |**  H** *  *  *|
    146.43 |**  H** *  ****|
    124.36 |**  H****  ****|
    102.29 |**  H****  ****|
     80.21 |** *H***** ****|
     58.14 |** *H***** ****|
     36.07 |** *H***** ****|
     14.00 |****H*****L****|
           +^----^----^----+
            0    5    10   
#+END_SRC

* stock_main Facebook Stock 5 to 43
Runs on a stock_main on a larger Facebook stock file. Prints indices
10 to 23 only which includes the high price.

#+TESTY: program='./stock_main data/stock-FB-08-02-2021.txt 15 5 43'
#+BEGIN_SRC sh
==STOCK DATA==
data_file: data/stock-FB-08-02-2021.txt
count: 543
prices: [358.94, 358.50, 358.50, ...]
lo_index:  470
hi_index:  15
best_buy:  109
best_sell: 129
profit:    2.38
==PLOT DATA==
start/stop:  5 43
max_height:  15
price range: 8.00
plot step:   0.53
           +--------------------------------------+
    358.46 |**********H***          *             |
    357.92 |**********H***************************|
    357.39 |**********H***************************|
    356.86 |**********H***************************|
    356.32 |**********H***************************|
    355.79 |**********H***************************|
    355.25 |**********H***************************|
    354.72 |**********H***************************|
    354.19 |**********H***************************|
    353.65 |**********H***************************|
    353.12 |**********H***************************|
    352.59 |**********H***************************|
    352.05 |**********H***************************|
    351.52 |**********H***************************|
    350.99 |**********H***************************|
           +^----^----^----^----^----^----^----^--+
            5    10   15   20   25   30   35   40   
#+END_SRC

* stock_main Facebook Stock 100 to 140
Runs on a stock_main on a larger Facebook stock file. Prints
indices 100 to 140 which includes to best buy/sell time. Note the best
buy/sell are completely different from the min/max prices here: a bad
day for Marky Z.

#+TESTY: program='./stock_main data/stock-FB-08-02-2021.txt 22 100 140'
#+BEGIN_SRC sh
==STOCK DATA==
data_file: data/stock-FB-08-02-2021.txt
count: 543
prices: [358.94, 358.50, 358.50, ...]
lo_index:  470
hi_index:  15
best_buy:  109
best_sell: 129
profit:    2.38
==PLOT DATA==
start/stop:  100 140
max_height:  22
price range: 8.00
plot step:   0.36
           +---------B===================S----------+
    358.63 |                                        |
    358.26 |                                        |
    357.90 |                                        |
    357.53 |                                        |
    357.17 |                                        |
    356.81 |                                        |
    356.44 |                                        |
    356.08 |                                        |
    355.72 |                                        |
    355.35 |*                                       |
    354.99 |****                         *          |
    354.62 |*****                     ******** * ** |
    354.26 |*****          *****      **************|
    353.90 |*******    *** ********  ***************|
    353.53 |********   *****************************|
    353.17 |********  ******************************|
    352.80 |********* ******************************|
    352.44 |****************************************|
    352.08 |****************************************|
    351.71 |****************************************|
    351.35 |****************************************|
    350.99 |****************************************|
           +^----^----^----^----^----^----^----^----+
            100  105  110  115  120  125  130  135  
#+END_SRC

* stock_main Facebook Stock 152 to 203
Runs on a stock_main on a larger Facebook stock file. The range is
slightly odd: 152 to 203 to check that the bottom index printing looks
correct. 

#+TESTY: program='./stock_main data/stock-FB-08-02-2021.txt 20 152 203'
#+BEGIN_SRC sh
==STOCK DATA==
data_file: data/stock-FB-08-02-2021.txt
count: 543
prices: [358.94, 358.50, 358.50, ...]
lo_index:  470
hi_index:  15
best_buy:  109
best_sell: 129
profit:    2.38
==PLOT DATA==
start/stop:  152 203
max_height:  20
price range: 8.00
plot step:   0.40
           +---------------------------------------------------+
    358.59 |                                                   |
    358.19 |                                                   |
    357.79 |                                                   |
    357.39 |                                                   |
    356.99 |                                                   |
    356.59 |                                                   |
    356.19 |                                                   |
    355.79 |                                                   |
    355.39 |                                                   |
    354.99 |                                                   |
    354.59 |                                                   |
    354.19 |                              *  * **             *|
    353.79 |                       ***********************   **|
    353.39 |*      **          * ******************************|
    352.99 |**** ***** ** *************************************|
    352.59 |***************************************************|
    352.19 |***************************************************|
    351.79 |***************************************************|
    351.39 |***************************************************|
    350.99 |***************************************************|
           +---^----^----^----^----^----^----^----^----^----^--+
               155  160  165  170  175  180  185  190  195  200  
#+END_SRC

* stock_main Facebook Stock 500 to End
Runs on a stock_main on a larger Facebook stock file. Only the
starting index is given which should cause plotting from there to the
end of the prices array to take place.

#+TESTY: program='./stock_main data/stock-FB-08-02-2021.txt 20 500'
#+BEGIN_SRC sh
==STOCK DATA==
data_file: data/stock-FB-08-02-2021.txt
count: 543
prices: [358.94, 358.50, 358.50, ...]
lo_index:  470
hi_index:  15
best_buy:  109
best_sell: 129
profit:    2.38
==PLOT DATA==
start/stop:  500 543
max_height:  20
price range: 8.00
plot step:   0.40
           +-------------------------------------------+
    358.59 |                                           |
    358.19 |                                           |
    357.79 |                                           |
    357.39 |                                           |
    356.99 |                                           |
    356.59 |                                           |
    356.19 |                                           |
    355.79 |                                           |
    355.39 |                                           |
    354.99 |                                           |
    354.59 |                                           |
    354.19 |                                           |
    353.79 |                                           |
    353.39 |                                           |
    352.99 |                                           |
    352.59 |                                           |
    352.19 |                                           |
    351.79 |******************* ************** * *     |
    351.39 |*******************************************|
    350.99 |*******************************************|
           +^----^----^----^----^----^----^----^----^--+
            500  505  510  515  520  525  530  535  540  
#+END_SRC

* stock_main Google Stock
Runs stock_main a large-ish Google stock price file. The whole range
is printed making this a very wide plot. Buy/Sell times correspond to
Lo/Hi prices.

#+TESTY: program='./stock_main data/stock-GOOG-08-02-2021.txt 30'
#+BEGIN_SRC sh
==STOCK DATA==
data_file: data/stock-GOOG-08-02-2021.txt
count: 345
prices: [2715.00, 2715.00, 2711.00, ...]
lo_index:  24
hi_index:  337
best_buy:  24
best_sell: 337
profit:    25.75
==PLOT DATA==
start/stop:  0 345
max_height:  30
price range: 25.75
plot step:   0.86
           +------------------------B========================================================================================================================================================================================================================================================================================================================S-------+
   2718.93 |                                                                                                                                                                                                                                                                                                                                               **H*******|
   2718.07 |                                                                                                                     *                                                                                                                                                                                                                         **H*******|
   2717.22 |                                                                                                                     **         **   *                                                                                                                                                                                                         **H*******|
   2716.36 |                                                                                                                    ****  ** *  ********                                                                                                                                                                                                      ***H*******|
   2715.50 |                                                                                                              *  *************************                                                                                                                                                                                                   ****H*******|
   2714.64 |**                                                                                                ***  * ***  ** **************************                                                                                                                                                                                                  ****H*******|
   2713.78 |**                                                                                               ****  *************************************                                                                                                                                    **                        *                                 *****H*******|
   2712.92 |**                                                                                              ***********************************************                                                                                                                               **** ********   ***      *****                                *****H*******|
   2712.07 |**                                                                                            * ***********************************************                                                                                                                          *  ***************** ****** ********                  *      * *   *****H*******|
   2711.21 |**        *                                                                                  ***************************************************                                                                                                                         ** **********************************      **        **     ** *   *****H*******|
   2710.35 |*** ** *  *                                                                                 ****************************************************                                                                                                                        **************************************** ********** * ****  *** **  *****H*******|
   2709.49 |****** *  ****                                     *                                        ****************************************************                                                               *                                                     ********************************************************************** *****H*******|
   2708.63 |********* ****                                   * **                                       ****************************************************               * *         *     *                           ***   *                                   *         * ******************************************************************************H*******|
   2707.77 |**************                                   *****                                    *******************************************************            *** *        **   *********                   *****   *                                  *******   *********************************************************************************H*******|
   2706.91 |**************                                  ******  * *           *                 * ********************************************************          ******  *     ***************             * *********  ***                               ********************************************************************************************H*******|
   2706.06 |**************                                  ******* ***   *       *                 ***********************************************************    *    ******* ***   *****************           ************ ***                              *********************************************************************************************H*******|
   2705.20 |**************                                  ************ **  **   *                 ***********************************************************   **    ******* ***  ****************** ** * *    *******************      **                 * *********************************************************************************************H*******|
   2704.34 |***************                                ************* *******  ***          *  ************************************************************** *** * ****************************************** ******************** *******               ************************************************************************************************H*******|
   2703.48 |*************** *                           ** ***************************         **************************************************************************************************************************************************   * * *** *************************************************************************************************H*******|
   2702.62 |*****************                           ******************************     * * **************************************************************************************************************************************************  **********************************************************************************************************H*******|
   2701.76 |*****************                   *      ********************************  ********************************************************************************************************************************************************************************************************************************************************************H*******|
   2700.91 |******************               * **      ******************************************************************************************************************************************************************************************************************************************************************************************************H*******|
   2700.05 |******************         *     ******   *******************************************************************************************************************************************************************************************************************************************************************************************************H*******|
   2699.19 |******************         *     ******   *******************************************************************************************************************************************************************************************************************************************************************************************************H*******|
   2698.33 |******************     *   ************  ********************************************************************************************************************************************************************************************************************************************************************************************************H*******|
   2697.47 |****************** *** *   ************  ********************************************************************************************************************************************************************************************************************************************************************************************************H*******|
   2696.61 |************************   ************ *********************************************************************************************************************************************************************************************************************************************************************************************************H*******|
   2695.76 |************************   **********************************************************************************************************************************************************************************************************************************************************************************************************************H*******|
   2694.90 |************************  ***********************************************************************************************************************************************************************************************************************************************************************************************************************H*******|
   2694.04 |************************L************************************************************************************************************************************************************************************************************************************************************************************************************************H*******|
           +^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----^----+
            0    5    10   15   20   25   30   35   40   45   50   55   60   65   70   75   80   85   90   95   100  105  110  115  120  125  130  135  140  145  150  155  160  165  170  175  180  185  190  195  200  205  210  215  220  225  230  235  240  245  250  255  260  265  270  275  280  285  290  295  300  305  310  315  320  325  330  335  340  
#+END_SRC
